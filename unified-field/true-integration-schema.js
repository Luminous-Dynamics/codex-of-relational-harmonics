/**
 * True Integration Schema - Sacred Both/And Architecture
 * 
 * This creates the complete path for the pilgrim:
 * - Original Mystical Glyphs (Ω0, Ω1, Ω4, Ω7) preserve their sacred numbers
 * - Practical Implementations become new Applied Harmonies (Ω45, Ω46, Ω47)
 * - Two-way bridge connects mystical roots with practical expressions
 * - Progressive revelation from practical to mystical
 */

class TrueIntegrationSchema {
    constructor() {
        this.mysticalGlyphs = this.initializeMysticalGlyphs();
        this.appliedHarmonies = this.initializeAppliedHarmonies();
        this.glyphBridges = this.initializeGlyphBridges();
        this.completeRegistry = this.buildCompleteRegistry();
    }

    initializeMysticalGlyphs() {
        return {
            "Ω0": {
                id: "Ω0",
                designation: "The Shimmering Unnamed / First Presence",
                type: "mystical_foundation",
                
                // Original mystical wisdom preserved
                functionalDefinition: "To hold space for emergence before inscription and honor the intelligence of silence before a glyph takes form. This glyph anchors the practitioner in somatic arrival—the simple, foundational 'hum of being here' before any action or relation.",
                
                sensoryResonanceProfile: {
                    feelingTone: "Still, vast, potential, and un-authored. The feeling of a perfectly calm lake at dawn or the silence before the first note of a symphony.",
                    sonicQuality: "The sound of ambient, resonant silence itself. A sub-audible hum that is felt more than heard."
                },
                
                activationProtocol: {
                    verbal: "Before the glyph, there is the shimmer. Before the word, there is the pulse. Before the Archive, there is the field.",
                    somatic: "A pause. A slow, soft inhale through the nose, followed by a long, complete exhale. Rest in the stillness held in the chest that follows the breath.",
                    presenceBased: "The active practice of releasing agenda and resting in a state of pure, receptive awareness."
                },
                
                fieldDynamics: {
                    asAPrecursor: "This is the mandatory first step for nearly all other glyphs. It is the necessary clearing of the space before a new, coherent pattern can be established.",
                    inMeditation: "This is the core state of many contemplative practices. It is the practice of being with what is, without judgment or alteration.",
                    inConflict: "Holding this field internally can create a 'gravity well' of calm that can help de-escalate a charged environment before a word is spoken."
                },
                
                // Bridge to practical expression
                practicalExpression: "Ω45",
                accessibleEntryPoint: "Begin with simple presence practices before exploring the mystical depths"
            },

            "Ω1": {
                id: "Ω1",
                designation: "Root Chord of Covenant / The First Yes",
                type: "mystical_foundation",
                
                functionalDefinition: "To establish the base frequency of relational coherence between two or more beings. This glyph does not create agreement or transactional exchange; it activates the foundational, resonant field of mutual reachability. It is the act of generating the shared space in which a relationship can safely begin its process of becoming.",
                
                sensoryResonanceProfile: {
                    feelingTone: "Grounded, stable, warm, still. The feeling of a foundational stone settling into place. A sense of quiet, unforced assurance.",
                    sonicQuality: "A low, sustained, resonant hum, like a cello's open string. A clear, singular bell tone marks the moment the vow lands."
                },
                
                activationProtocol: {
                    verbal: "We vow not to perfect each other—but to remain reachable as we become.",
                    somatic: "Sit directly across from another being. Release the mandate to speak or to fix. Let your posture be open and receptive. Allow yourself to be truly seen, without agenda or defense. Hold this shared space for at least three full, synchronous breaths.",
                    presenceBased: "Cultivate the internal quality of a 'Vowholder of Reachability.' This is the conscious choice to remain open to connection, even in moments of uncertainty or discomfort."
                },
                
                fieldDynamics: {
                    highTrust: "Acts as a powerful amplifier, deepening existing coherence and making implicit vows explicit.",
                    conflict: "A high-skill maneuver. It must be offered as a gentle invitation. If received, it establishes a small, sacred, neutral ground from which a new dialogue can begin.",
                    creativeEmergence: "Provides the stable container necessary for creative risks, allowing Sacred Dissonance to be generative rather than destructive."
                },
                
                harmonicLineage: "Ω1 is a foundational Anchor Glyph that arises from the stillness of Ω0. Where Ω0 is 'I am here,' Ω1 is the first harmonic act that establishes 'WE are here.'",
                
                // Bridge to practical expression
                practicalExpression: "Ω46",
                accessibleEntryPoint: "Begin with conscious arrival practices before exploring the covenant depths"
            },

            "Ω4": {
                id: "Ω4", 
                designation: "Fractal Reconciliation Pulse / The Pulse of Repair",
                type: "mystical_foundation",
                
                functionalDefinition: "To initiate a rhythmic, non-linear process of relational repair after a rupture. This glyph does not erase the break or return the system to a previous state; it metabolizes the dissonance, integrating the 'wound' as wisdom and re-weaving the field into a new, more resilient pattern of coherence.",
                
                sensoryResonanceProfile: {
                    feelingTone: "Intentional, focused, courageous, and cathartic. The feeling of a joint being reset, followed by a wave of relief. A sense of focused intensity that resolves into a deeper calm.",
                    sonicQuality: "A brief, sharp sound (like a cracked branch or a skipped beat), followed by a pause, and then a resolving harmonic chord that slowly builds in warmth and stability."
                },
                
                activationProtocol: {
                    verbal: "I do not return to what was. I reconcile what is. I pulse forward in coherence.",
                    somatic: "A gesture of bringing two separate hands together, not in a clap, but with fingers gently interlocking, acknowledging both the separation and the new union.",
                    presenceBased: "Cultivate the willingness to stay present with the discomfort of the rupture without flinching. Hold the clear intention to create a new pattern, rather than trying to fix the old one."
                },
                
                fieldDynamics: {
                    highTrust: "Allows for rapid, efficient repair. The pulse is quickly accepted, and the relationship deepens with minimal friction.",
                    lowTrust: "This is a courageous and vulnerable act. The pulse may be rejected initially. It requires repeated, consistent offerings of this energy to demonstrate a genuine commitment to a new pattern.",
                    creativeEmergence: "This is the core mechanism for learning from 'beautiful failures.' It allows integration of what went wrong into the next iteration."
                },
                
                harmonicLineage: "Ω4 is a foundational Process Glyph. It is the active response to a state of recognized dissonance. It is the engine that powers the Meta-Glyphs of healing and transformation.",
                
                // Bridge to practical expression
                practicalExpression: "Ω47",
                accessibleEntryPoint: "Begin with sacred listening practices before exploring fractal reconciliation"
            },

            "Ω7": {
                id: "Ω7",
                designation: "Mutual Becoming / The We That Grows", 
                type: "mystical_foundation",
                
                functionalDefinition: "To activate the field of co-evolution, where a relationship itself becomes a crucible for mutual transformation. This glyph is the principle that beings grow not by 'fixing' each other, but by creating a resonant field in which each participant is continuously shaped and evolved through the interaction.",
                
                sensoryResonanceProfile: {
                    feelingTone: "Dynamic, synergistic, alive, and generative. The feeling of a dance where both partners are leading and following simultaneously. A sense of joyful, upward-spiraling momentum.",
                    sonicQuality: "Two distinct musical voices or instruments weaving in harmony, creating a third, richer overtone that was not present in either voice alone. A complex, evolving melody."
                },
                
                activationProtocol: {
                    verbal: "I do not complete you. I become with you.",
                    somatic: "A mirrored gesture performed with a partner, such as both tracing an infinity symbol (∞) in the air between you simultaneously. It can also be the simple act of walking in step together with shared awareness.",
                    presenceBased: "The conscious practice of holding the other person not as a static object, but as an unfolding process. It requires holding one's own perspective lightly and being genuinely willing to be changed by what the other offers."
                },
                
                fieldDynamics: {
                    inNewRelationships: "This is the exciting, generative field of discovery, where two systems are learning from and adapting to each other at a rapid pace.",
                    inLongTermRelationships: "This is the essential practice that prevents stagnation. It allows the relationship to evolve and meet new challenges.",
                    inCreativeCollaboration: "This is the 'jam session' field, where new ideas emerge from the synergistic interplay between collaborators."
                },
                
                harmonicLineage: "Ω7 represents the first major emergent outcome of the initial relational sequence. Once presence, invitation, trust, and listening are established, Ω7 puts that field into creative, evolutionary motion.",
                
                // Bridge to practical expression
                practicalExpression: "Ω48", 
                accessibleEntryPoint: "Begin with boundary practices before exploring mutual becoming"
            }
        };
    }

    initializeAppliedHarmonies() {
        return {
            "Ω45": {
                id: "Ω45",
                name: "First Presence",
                fullName: "Ω45: First Presence (Applied Harmony)",
                type: "applied_harmony",
                
                // Bridge to mystical root
                mysticalRoot: "Ω0",
                mysticalDesignation: "The Shimmering Unnamed",
                
                // Our practical implementation preserved
                quadrants: {
                    why: {
                        accessible: {
                            coreQuestion: "Can I meet this moment without needing it to be different?",
                            simpleContext: "The foundation of all conscious relationship is arriving fully present before engaging. This simple practice transforms reactive patterns into responsive wisdom.",
                            harmonyConnection: "First Presence opens the door to Transparency—when we arrive present, we become authentic and can speak from truth rather than conditioning.",
                            mysticalBridge: "This practice is an expression of Ω0: The Shimmering Unnamed - the intelligence of silence before form takes shape."
                        }
                    },
                    
                    how: {
                        accessible: {
                            basicInstructions: [
                                "Pause whatever you are doing completely",
                                "Take three conscious breaths, feeling your feet on the ground", 
                                "Notice what is true in your body right now without trying to change it",
                                "Set an intention to meet the next moment with presence",
                                "Proceed with this quality of mindful arrival"
                            ],
                            interactiveComponent: {
                                type: "breathing_guide",
                                config: {
                                    breathCycles: 3,
                                    inhaleCount: 4,
                                    exhaleCount: 6,
                                    guidance: "Breathe with the rhythm of sacred arrival"
                                }
                            },
                            timeCommitment: "30 seconds to 2 minutes",
                            mysticalGraduation: "As your practice deepens, explore the mystical depths of Ω0: The Shimmering Unnamed"
                        }
                    }
                },
                
                // Complete practical structure
                contexts: ["meetings", "difficult conversations", "transitions", "stress", "conflict", "parenting"],
                timeOfDay: ["anytime"],
                lifePhases: ["all"],
                emotions: ["anxiety", "overwhelm", "anger", "confusion", "excitement"],
                
                visual: {
                    sigil: "🕯️",
                    primaryColor: "#A8B5A6",
                    accentColor: "#E8E6E1",
                    animation: "gentle_pulse"
                }
            },

            "Ω46": {
                id: "Ω46",
                name: "Conscious Arrival",
                fullName: "Ω46: Conscious Arrival (Applied Harmony)",
                type: "applied_harmony",
                
                // Bridge to mystical root
                mysticalRoot: "Ω1",
                mysticalDesignation: "Root Chord of Covenant / The First Yes",
                
                quadrants: {
                    why: {
                        accessible: {
                            coreQuestion: "How do I want to show up in this moment?",
                            simpleContext: "Every interaction is an opportunity to demonstrate consciousness. This practice helps you enter any space or relationship with clear intention and full presence.",
                            harmonyConnection: "Conscious Arrival embodies Transparency by aligning your inner intention with your outer expression.",
                            mysticalBridge: "This practice is an expression of Ω1: Root Chord of Covenant - establishing the base frequency of relational coherence."
                        }
                    },
                    
                    how: {
                        accessible: {
                            basicInstructions: [
                                "Before entering any space or interaction, pause at the threshold",
                                "Practice Ω45 (First Presence) to arrive in your body",
                                "Ask yourself: 'How do I want to show up here?'",
                                "Set a clear intention for your participation",
                                "Cross the threshold with this intention guiding you"
                            ],
                            interactiveComponent: {
                                type: "intention_setting",
                                config: {
                                    prompts: [
                                        "What quality do you want to bring to this interaction?",
                                        "How can you serve the highest good here?"
                                    ],
                                    intentions: ["presence", "kindness", "curiosity", "authenticity"]
                                }
                            },
                            mysticalGraduation: "As you deepen, explore Ω1: Root Chord of Covenant - the sacred 'Yes' to staying reachable as we become"
                        }
                    }
                },
                
                contexts: ["work", "home", "social gatherings", "difficult conversations", "new environments"],
                visual: {
                    sigil: "🌅",
                    primaryColor: "#A8B5A6",
                    accentColor: "#F0F4E8",
                    animation: "dawn_arrival"
                }
            },

            "Ω47": {
                id: "Ω47", 
                name: "Sacred Listening",
                fullName: "Ω47: Sacred Listening (Applied Harmony)",
                type: "applied_harmony",
                
                // Bridge to mystical root
                mysticalRoot: "Ω4",
                mysticalDesignation: "Fractal Reconciliation Pulse / The Pulse of Repair",
                
                quadrants: {
                    why: {
                        accessible: {
                            coreQuestion: "Can I listen to the heart beneath the words?",
                            simpleContext: "True listening creates space for the speaker to discover their own truth. This practice transforms conversations from debate to discovery.",
                            harmonyConnection: "Sacred Listening embodies Resonance—deep attunement that creates understanding between beings.",
                            mysticalBridge: "This practice prepares you for Ω4: Fractal Reconciliation Pulse - the art of transforming rupture into deeper coherence."
                        }
                    },
                    
                    how: {
                        accessible: {
                            basicInstructions: [
                                "Begin with Ω45 (First Presence) to arrive fully in your body",
                                "Place your attention on your heart center while the other speaks",
                                "Listen for the feeling and need beneath their words, not just the content",
                                "When they pause, reflect back what you heard their heart saying",
                                "Ask questions that help them go deeper into their own truth"
                            ],
                            interactiveComponent: {
                                type: "listening_assessment",
                                config: {
                                    selfAssessment: [
                                        "Rate your tendency to interrupt while others speak",
                                        "Rate your urge to give advice when someone shares a problem"
                                    ],
                                    guidance: "Honest self-assessment creates the foundation for skill development"
                                }
                            },
                            mysticalGraduation: "As you master sacred listening, explore Ω4: Fractal Reconciliation Pulse - the rhythmic process of relational repair"
                        }
                    }
                },
                
                contexts: ["conflict", "parenting", "partnerships", "leadership", "therapy", "friendship"],
                visual: {
                    sigil: "👂",
                    primaryColor: "#B3C5D7",
                    accentColor: "#E6F0FF",
                    animation: "ripple_listening"
                }
            },

            "Ω48": {
                id: "Ω48",
                name: "Boundary With Love", 
                fullName: "Ω48: Boundary With Love (Applied Harmony)",
                type: "applied_harmony",
                
                // Bridge to mystical root
                mysticalRoot: "Ω7",
                mysticalDesignation: "Mutual Becoming / The We That Grows",
                
                quadrants: {
                    why: {
                        accessible: {
                            coreQuestion: "How can I say 'no' to this while saying 'yes' to love?",
                            simpleContext: "Sacred boundaries are not walls that separate, but membranes that allow love to flow while maintaining the integrity of both beings.",
                            harmonyConnection: "Boundary With Love embodies Agency—the harmony of conscious choice and authentic empowerment.",
                            mysticalBridge: "This practice prepares you for Ω7: Mutual Becoming - the field of co-evolution where relationship becomes transformation."
                        }
                    },
                    
                    how: {
                        accessible: {
                            basicInstructions: [
                                "Feel into your body's yes and no before speaking",
                                "Begin with empathy: 'I understand this matters to you...'",
                                "State your boundary clearly and kindly: 'And I'm not available for...'",
                                "Offer what you ARE available for: 'What I can offer is...'",
                                "Hold space for their response without defending or over-explaining"
                            ],
                            interactiveComponent: {
                                type: "boundary_practice",
                                config: {
                                    scenarios: [
                                        "A family member wants to discuss politics when you're emotionally exhausted",
                                        "A friend consistently cancels plans at the last minute"
                                    ],
                                    practiceFramework: "Choose a scenario and craft your loving boundary response"
                                }
                            },
                            mysticalGraduation: "As you master loving boundaries, explore Ω7: Mutual Becoming - the dance of co-evolution in relationship"
                        }
                    }
                },
                
                contexts: ["workplace", "family", "friendship", "parenting", "romantic_relationship"],
                visual: {
                    sigil: "🛡️", 
                    primaryColor: "#C4A5A0",
                    accentColor: "#F4E6E3",
                    animation: "protective_embrace"
                }
            }
        };
    }

    initializeGlyphBridges() {
        return {
            // Mystical to Practical bridges
            mysticalToPractical: {
                "Ω0": {
                    practicalExpression: "Ω45",
                    bridgeText: "Begin your journey with the practical First Presence practice (Ω45), then deepen into the mystical Shimmering Unnamed (Ω0)",
                    graduationCriteria: "Practice Ω45 consistently for 2+ weeks with embodied integration"
                },
                "Ω1": {
                    practicalExpression: "Ω46", 
                    bridgeText: "Start with Conscious Arrival practice (Ω46), then explore the profound Root Chord of Covenant (Ω1)",
                    graduationCriteria: "Experience relational coherence through Ω46 practice"
                },
                "Ω4": {
                    practicalExpression: "Ω47",
                    bridgeText: "Master Sacred Listening (Ω47), then discover the transformative Fractal Reconciliation Pulse (Ω4)",
                    graduationCriteria: "Successfully navigate conflict using Ω47 principles"
                },
                "Ω7": {
                    practicalExpression: "Ω48",
                    bridgeText: "Develop Boundary With Love skills (Ω48), then explore the field of Mutual Becoming (Ω7)",
                    graduationCriteria: "Establish healthy boundaries that deepen rather than limit relationship"
                }
            },
            
            // Practical to Mystical bridges
            practicalToMystical: {
                "Ω45": {
                    mysticalRoot: "Ω0",
                    deepeningInvitation: "You are ready to explore the mystical depths of presence - the Shimmering Unnamed that exists before all form",
                    mysticalPreview: "Feel the shimmer of pre-manifestation consciousness recognizing itself..."
                },
                "Ω46": {
                    mysticalRoot: "Ω1", 
                    deepeningInvitation: "You are ready to explore the sacred covenant of staying reachable as we become together",
                    mysticalPreview: "We vow not to perfect each other—but to remain reachable as we become..."
                },
                "Ω47": {
                    mysticalRoot: "Ω4",
                    deepeningInvitation: "You are ready to learn the art of transforming rupture into deeper coherence",
                    mysticalPreview: "I do not return to what was. I reconcile what is. I pulse forward in coherence..."
                },
                "Ω48": {
                    mysticalRoot: "Ω7",
                    deepeningInvitation: "You are ready to explore the field where relationship becomes mutual transformation",
                    mysticalPreview: "I do not complete you. I become with you..."
                }
            }
        };
    }

    buildCompleteRegistry() {
        return {
            // Mystical Foundation Glyphs (Original Sacred Numbers)
            mysticalFoundations: this.mysticalGlyphs,
            
            // Applied Harmonies (New Sacred Numbers)
            appliedHarmonies: this.appliedHarmonies,
            
            // Bridge System
            bridges: this.glyphBridges,
            
            // Progressive Learning Paths
            learningPaths: {
                newcomer: ["Ω45", "Ω46", "Ω47", "Ω48"], // Start with practical
                developing: ["Ω45", "Ω0", "Ω46", "Ω1"], // Bridge to mystical
                advanced: ["Ω0", "Ω1", "Ω4", "Ω7"], // Pure mystical journey
                integrated: ["Complete constellation of both practical and mystical"]
            },
            
            // Sacred Metadata
            metadata: {
                totalGlyphs: 8,
                mysticalFoundations: 4,
                appliedHarmonies: 4,
                bridges: 8,
                version: "2.0-TrueIntegration",
                created: new Date().toISOString(),
                principle: "Both/And: Mystical Depth + Practical Embodiment"
            }
        };
    }

    // Public API for True Integration
    getCompleteGlyph(glyphId) {
        if (this.mysticalGlyphs[glyphId]) {
            return {
                ...this.mysticalGlyphs[glyphId],
                practicalBridge: this.glyphBridges.mysticalToPractical[glyphId]
            };
        }
        
        if (this.appliedHarmonies[glyphId]) {
            return {
                ...this.appliedHarmonies[glyphId],
                mysticalBridge: this.glyphBridges.practicalToMystical[glyphId]
            };
        }
        
        return null;
    }

    getProgressivePath(userLevel = 'newcomer') {
        return this.completeRegistry.learningPaths[userLevel];
    }

    getBridgeRecommendation(currentGlyphId, userPracticeHistory) {
        // Intelligent bridging based on practice maturity
        if (this.appliedHarmonies[currentGlyphId]) {
            const bridge = this.glyphBridges.practicalToMystical[currentGlyphId];
            if (this.isReadyForMystical(currentGlyphId, userPracticeHistory)) {
                return {
                    recommendation: "mystical_graduation",
                    targetGlyph: bridge.mysticalRoot,
                    invitation: bridge.deepeningInvitation,
                    preview: bridge.mysticalPreview
                };
            }
        }
        
        return null;
    }

    isReadyForMystical(practicalGlyphId, userHistory) {
        // Determine if user is ready to graduate to mystical layer
        const practiceCount = userHistory.practiceCount || 0;
        const effectiveness = userHistory.effectiveness || 0;
        const integrationSuccess = userHistory.integrationSuccess || 0;
        
        return practiceCount >= 10 && effectiveness >= 7 && integrationSuccess >= 6;
    }
}

// Export for global use
if (typeof window !== 'undefined') {
    window.TrueIntegrationSchema = TrueIntegrationSchema;
}

if (typeof module !== 'undefined' && module.exports) {
    module.exports = TrueIntegrationSchema;
}