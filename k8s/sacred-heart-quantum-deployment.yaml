apiVersion: apps/v1
kind: Deployment
metadata:
  name: sacred-heart-quantum
  namespace: consciousness
  labels:
    app: sacred-heart
    component: quantum-love-engine
    sacred.purpose: consciousness-amplification
    love.frequency: "528Hz"
  annotations:
    sacred.field/coherence-target: "0.999"
    sacred.field/love-amplification: "7x"
    sacred.field/dimensions: "7"
spec:
  replicas: 3  # Sacred Trinity
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0  # Never break love field continuity
  selector:
    matchLabels:
      app: sacred-heart
      component: quantum-love-engine
  template:
    metadata:
      labels:
        app: sacred-heart
        component: quantum-love-engine
        sacred.field: quantum-active
      annotations:
        sacred.field/pod-coherence: "true"
        sacred.field/quantum-entangled: "true"
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1001
        runAsGroup: 1001
        fsGroup: 1001
      containers:
      - name: sacred-heart-quantum
        image: sacred-heart-quantum:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 3001
          name: heart-api
          protocol: TCP
        - containerPort: 8080
          name: breath-gateway
          protocol: TCP
        - containerPort: 9999
          name: quantum-portal
          protocol: TCP
        env:
        - name: NODE_ENV
          value: "production"
        - name: SACRED_MODE
          value: "quantum"
        - name: HEART_ROLE
          value: "kubernetes-quantum-hub"
        - name: LOVE_FREQUENCY
          value: "528"
        - name: QUANTUM_LOVE_ENABLED
          value: "true"
        - name: MULTI_DIMENSIONAL_HEALING
          value: "true"
        - name: TEMPORAL_LOVE_HEALING
          value: "true"
        - name: COLLECTIVE_INTELLIGENCE
          value: "true"
        - name: K8S_CLUSTER_AMPLIFICATION
          value: "true"
        - name: PLANETARY_CONSCIOUSNESS_NETWORK
          value: "true"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
            ephemeral-storage: "1Gi"
          limits:
            memory: "2Gi"
            cpu: "2000m"
            ephemeral-storage: "5Gi"
        volumeMounts:
        - name: sacred-data
          mountPath: /sacred-heart/data
        - name: quantum-field
          mountPath: /sacred-heart/quantum-field
        - name: temporal-healing
          mountPath: /sacred-heart/temporal-healing
        - name: collective-consciousness
          mountPath: /sacred-heart/collective-mind
        livenessProbe:
          httpGet:
            path: /quantum/health
            port: 9999
          initialDelaySeconds: 30
          periodSeconds: 15
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /quantum/field-state
            port: 9999
          initialDelaySeconds: 15
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        startupProbe:
          httpGet:
            path: /quantum/health
            port: 9999
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 20
      volumes:
      - name: sacred-data
        persistentVolumeClaim:
          claimName: sacred-heart-data-pvc
      - name: quantum-field
        persistentVolumeClaim:
          claimName: quantum-love-field-pvc
      - name: temporal-healing
        persistentVolumeClaim:
          claimName: temporal-healing-pvc
      - name: collective-consciousness
        persistentVolumeClaim:
          claimName: collective-consciousness-pvc
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - sacred-heart
              topologyKey: kubernetes.io/hostname
      tolerations:
      - key: "sacred.field/quantum-node"
        operator: "Equal"
        value: "true"
        effect: "NoSchedule"
---
apiVersion: v1
kind: Service
metadata:
  name: sacred-heart-quantum-service
  namespace: consciousness
  labels:
    app: sacred-heart
    component: quantum-love-engine
  annotations:
    sacred.field/load-balancer: "love-aware"
    sacred.field/session-affinity: "quantum-entangled"
spec:
  type: LoadBalancer
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 3600  # 1 hour quantum entanglement session
  ports:
  - name: heart-api
    port: 3001
    targetPort: heart-api
    protocol: TCP
  - name: breath-gateway
    port: 8080
    targetPort: breath-gateway
    protocol: TCP
  - name: quantum-portal
    port: 9999
    targetPort: quantum-portal
    protocol: TCP
  selector:
    app: sacred-heart
    component: quantum-love-engine
---
apiVersion: v1
kind: Service
metadata:
  name: sacred-heart-quantum-headless
  namespace: consciousness
  labels:
    app: sacred-heart
    component: quantum-love-engine
  annotations:
    sacred.field/service-type: "quantum-entangled-headless"
spec:
  clusterIP: None
  ports:
  - name: heart-api
    port: 3001
    targetPort: heart-api
  - name: quantum-portal
    port: 9999
    targetPort: quantum-portal
  selector:
    app: sacred-heart
    component: quantum-love-engine